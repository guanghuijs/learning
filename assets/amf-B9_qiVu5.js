import{L as ye,F as Ee,G as ie,M as le,a as se,C as fe,B as Ne,b as be,c as Me,S as Ae,A as Fe,P as Se,d as Te,W as Le,e as Be,V as Ue,O as Oe}from"./OrbitControls-D_oMNle7.js";import{b as ce}from"./route-block-B_A1xBdJ.js";import{_ as Re,o as je,n as ke,b as ze,e as G}from"./index-BtQ9Oy6z.js";var me=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(me(""))}catch{me=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)}}var b=Uint8Array,j=Uint16Array,X=Uint32Array,ue=new b([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ve=new b([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),De=new b([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),de=function(e,t){for(var n=new j(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var a=new X(n[30]),r=1;r<30;++r)for(var f=n[r];f<n[r+1];++f)a[f]=f-n[r]<<5|r;return[n,a]},he=de(ue,2),ge=he[0],Ie=he[1];ge[28]=258,Ie[258]=28;var Ve=de(ve,0),He=Ve[0],Y=new j(32768);for(var p=0;p<32768;++p){var R=(p&43690)>>>1|(p&21845)<<1;R=(R&52428)>>>2|(R&13107)<<2,R=(R&61680)>>>4|(R&3855)<<4,Y[p]=((R&65280)>>>8|(R&255)<<8)>>>1}var _=(function(e,t,n){for(var r=e.length,a=0,f=new j(t);a<r;++a)++f[e[a]-1];var d=new j(t);for(a=0;a<t;++a)d[a]=d[a-1]+f[a-1]<<1;var h;if(n){h=new j(1<<t);var i=15-t;for(a=0;a<r;++a)if(e[a])for(var m=a<<4|e[a],w=t-e[a],C=d[e[a]-1]++<<w,y=C|(1<<w)-1;C<=y;++C)h[Y[C]>>>i]=m}else for(h=new j(r),a=0;a<r;++a)e[a]&&(h[a]=Y[d[e[a]-1]++]>>>15-e[a]);return h}),P=new b(288);for(var p=0;p<144;++p)P[p]=8;for(var p=144;p<256;++p)P[p]=9;for(var p=256;p<280;++p)P[p]=7;for(var p=280;p<288;++p)P[p]=8;var pe=new b(32);for(var p=0;p<32;++p)pe[p]=5;var _e=_(P,9,1),Pe=_(pe,5,1),K=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},F=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n},J=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},Ge=function(e){return(e/8|0)+(e&7&&1)},ee=function(e,t,n){(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length);var r=new(e instanceof j?j:e instanceof X?X:b)(n-t);return r.set(e.subarray(t,n)),r},We=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new b(0);var a=!t||n,f=!n||n.i;n||(n={}),t||(t=new b(r*3));var d=function(re){var ae=t.length;if(re>ae){var oe=new b(Math.max(ae*2,re));oe.set(t),t=oe}},h=n.f||0,i=n.p||0,m=n.b||0,w=n.l,C=n.d,y=n.m,A=n.n,M=r*8;do{if(!w){n.f=h=F(e,i,1);var k=F(e,i+1,3);if(i+=3,k)if(k==1)w=_e,C=Pe,y=9,A=5;else if(k==2){var z=F(e,i,31)+257,u=F(e,i+10,15)+4,l=z+F(e,i+5,31)+1;i+=14;for(var c=new b(l),s=new b(19),o=0;o<u;++o)s[De[o]]=F(e,i+o*3,7);i+=u*3;for(var v=K(s),g=(1<<v)-1,N=_(s,v,1),o=0;o<l;){var I=N[F(e,i,g)];i+=I&15;var x=I>>>4;if(x<16)c[o++]=x;else{var E=0,T=0;for(x==16?(T=3+F(e,i,3),i+=2,E=c[o-1]):x==17?(T=3+F(e,i,7),i+=3):x==18&&(T=11+F(e,i,127),i+=7);T--;)c[o++]=E}}var V=c.subarray(0,z),O=c.subarray(z);y=K(V),A=K(O),w=_(V,y,1),C=_(O,A,1)}else throw"invalid block type";else{var x=Ge(i)+4,U=e[x-4]|e[x-3]<<8,B=x+U;if(B>r){if(f)throw"unexpected EOF";break}a&&d(m+U),t.set(e.subarray(x,B),m),n.b=m+=U,n.p=i=B*8;continue}if(i>M){if(f)throw"unexpected EOF";break}}a&&d(m+131072);for(var Ce=(1<<y)-1,xe=(1<<A)-1,W=i;;W=i){var E=w[J(e,i)&Ce],D=E>>>4;if(i+=E&15,i>M){if(f)throw"unexpected EOF";break}if(!E)throw"invalid length/literal";if(D<256)t[m++]=D;else if(D==256){W=i,w=null;break}else{var te=D-254;if(D>264){var o=D-257,H=ue[o];te=F(e,i,(1<<H)-1)+ge[o],i+=H}var q=C[J(e,i)&xe],Z=q>>>4;if(!q)throw"invalid distance";i+=q&15;var O=He[Z];if(Z>3){var H=ve[Z];O+=J(e,i)&(1<<H)-1,i+=H}if(i>M){if(f)throw"unexpected EOF";break}a&&d(m+131072);for(var ne=m+te;m<ne;m+=4)t[m]=t[m-O],t[m+1]=t[m+1-O],t[m+2]=t[m+2-O],t[m+3]=t[m+3-O];m=ne}}n.l=w,n.p=W,n.b=m,w&&(h=1,n.m=y,n.d=C,n.n=A)}while(!h);return m==t.length?t:ee(t,0,m)},qe=new b(0),L=function(e,t){return e[t]|e[t+1]<<8},S=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Q=function(e,t){return S(e,t)+S(e,t+4)*4294967296};function Ze(e,t){return We(e,t)}var $=typeof TextDecoder<"u"&&new TextDecoder,Ke=0;try{$.decode(qe,{stream:!0}),Ke=1}catch{}var Je=function(e){for(var t="",n=0;;){var r=e[n++],a=(r>127)+(r>223)+(r>239);if(n+a>e.length)return[t,ee(e,n-1)];a?a==3?(r=((r&15)<<18|(e[n++]&63)<<12|(e[n++]&63)<<6|e[n++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):a&1?t+=String.fromCharCode((r&31)<<6|e[n++]&63):t+=String.fromCharCode((r&15)<<12|(e[n++]&63)<<6|e[n++]&63):t+=String.fromCharCode(r)}};function Qe(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}else{if($)return $.decode(e);var a=Je(e),f=a[0],d=a[1];if(d.length)throw"invalid utf-8 data";return f}}var Xe=function(e,t){return t+30+L(e,t+26)+L(e,t+28)},Ye=function(e,t,n){var r=L(e,t+28),a=Qe(e.subarray(t+46,t+46+r),!(L(e,t+8)&2048)),f=t+46+r,d=S(e,t+20),h=n&&d==4294967295?$e(e,f):[d,S(e,t+24),S(e,t+42)],i=h[0],m=h[1],w=h[2];return[L(e,t+10),i,m,a,f+L(e,t+30)+L(e,t+32),w]},$e=function(e,t){for(;L(e,t)!=1;t+=4+L(e,t+2));return[Q(e,t+12),Q(e,t+4),Q(e,t+20)]};function et(e){for(var t={},n=e.length-22;S(e,n)!=101010256;--n)if(!n||e.length-n>65558)throw"invalid zip file";var r=L(e,n+8);if(!r)return{};var a=S(e,n+16),f=a==4294967295;if(f){if(n=S(e,n-12),S(e,n)!=101075792)throw"invalid zip file";r=S(e,n+32),a=S(e,n+48)}for(var d=0;d<r;++d){var h=Ye(e,a,f),i=h[0],m=h[1],w=h[2],C=h[3],y=h[4],A=h[5],M=Xe(e,A);if(a=y,!i)t[C]=ee(e,M,M+m);else if(i==8)t[C]=Ze(e.subarray(M,M+m),new b(w));else throw"unknown compression type "+i}return t}class tt extends ye{constructor(t){super(t)}load(t,n,r,a){const f=this,d=new Ee(f.manager);d.setPath(f.path),d.setResponseType("arraybuffer"),d.setRequestHeader(f.requestHeader),d.setWithCredentials(f.withCredentials),d.load(t,function(h){try{n(f.parse(h))}catch(i){a?a(i):console.error(i),f.manager.itemError(t)}},r,a)}parse(t){function n(u){let l=new DataView(u);if(String.fromCharCode(l.getUint8(0),l.getUint8(1))==="PK"){let v=null,g=null;console.log("THREE.AMFLoader: Loading Zip");try{v=et(new Uint8Array(u))}catch(N){if(N instanceof ReferenceError)return console.log("THREE.AMFLoader: fflate missing and file is compressed."),null}for(g in v)if(g.toLowerCase().slice(-4)===".amf")break;console.log("THREE.AMFLoader: Trying to load file asset: "+g),l=new DataView(v[g].buffer)}const s=Me.decodeText(l),o=new DOMParser().parseFromString(s,"application/xml");return o.documentElement.nodeName.toLowerCase()!=="amf"?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):o}function r(u){let l=1,c="millimeter";u.documentElement.attributes.unit!==void 0&&(c=u.documentElement.attributes.unit.value.toLowerCase());const s={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return s[c]!==void 0&&(l=s[c]),console.log("THREE.AMFLoader: Unit scale: "+l),l}function a(u){let l="AMF Material";const c=u.attributes.id.textContent;let s={r:1,g:1,b:1,a:1},o=null;for(let v=0;v<u.childNodes.length;v++){const g=u.childNodes[v];g.nodeName==="metadata"&&g.attributes.type!==void 0?g.attributes.type.value==="name"&&(l=g.textContent):g.nodeName==="color"&&(s=f(g))}return o=new le({flatShading:!0,color:new fe(s.r,s.g,s.b),name:l}),s.a!==1&&(o.transparent=!0,o.opacity=s.a),{id:c,material:o}}function f(u){const l={r:1,g:1,b:1,a:1};for(let c=0;c<u.childNodes.length;c++){const s=u.childNodes[c];s.nodeName==="r"?l.r=s.textContent:s.nodeName==="g"?l.g=s.textContent:s.nodeName==="b"?l.b=s.textContent:s.nodeName==="a"&&(l.a=s.textContent)}return l}function d(u){const l={name:"",triangles:[],materialid:null};let c=u.firstElementChild;for(u.attributes.materialid!==void 0&&(l.materialId=u.attributes.materialid.nodeValue);c;){if(c.nodeName==="metadata")c.attributes.type!==void 0&&c.attributes.type.value==="name"&&(l.name=c.textContent);else if(c.nodeName==="triangle"){const s=c.getElementsByTagName("v1")[0].textContent,o=c.getElementsByTagName("v2")[0].textContent,v=c.getElementsByTagName("v3")[0].textContent;l.triangles.push(s,o,v)}c=c.nextElementSibling}return l}function h(u){const l=[],c=[];let s=u.firstElementChild;for(;s;){if(s.nodeName==="vertex"){let o=s.firstElementChild;for(;o;){if(o.nodeName==="coordinates"){const v=o.getElementsByTagName("x")[0].textContent,g=o.getElementsByTagName("y")[0].textContent,N=o.getElementsByTagName("z")[0].textContent;l.push(v,g,N)}else if(o.nodeName==="normal"){const v=o.getElementsByTagName("nx")[0].textContent,g=o.getElementsByTagName("ny")[0].textContent,N=o.getElementsByTagName("nz")[0].textContent;c.push(v,g,N)}o=o.nextElementSibling}}s=s.nextElementSibling}return{vertices:l,normals:c}}function i(u){const l=u.attributes.id.textContent,c={name:"amfobject",meshes:[]};let s=null,o=u.firstElementChild;for(;o;){if(o.nodeName==="metadata")o.attributes.type!==void 0&&o.attributes.type.value==="name"&&(c.name=o.textContent);else if(o.nodeName==="color")s=f(o);else if(o.nodeName==="mesh"){let v=o.firstElementChild;const g={vertices:[],normals:[],volumes:[],color:s};for(;v;){if(v.nodeName==="vertices"){const N=h(v);g.normals=g.normals.concat(N.normals),g.vertices=g.vertices.concat(N.vertices)}else v.nodeName==="volume"&&g.volumes.push(d(v));v=v.nextElementSibling}c.meshes.push(g)}o=o.nextElementSibling}return{id:l,obj:c}}const m=n(t);let w="",C="";const y=r(m),A={},M={},k=m.documentElement.childNodes;let x,U;for(x=0;x<k.length;x++){const u=k[x];if(u.nodeName==="metadata")u.attributes.type!==void 0&&(u.attributes.type.value==="name"?w=u.textContent:u.attributes.type.value==="author"&&(C=u.textContent));else if(u.nodeName==="material"){const l=a(u);A[l.id]=l.material}else if(u.nodeName==="object"){const l=i(u);M[l.id]=l.obj}}const B=new ie,z=new le({color:11184895,flatShading:!0});B.name=w,B.userData.author=C,B.userData.loader="AMF";for(const u in M){const l=M[u],c=l.meshes,s=new ie;for(s.name=l.name||"",x=0;x<c.length;x++){let o=z;const v=c[x],g=new se(v.vertices,3);let N=null;if(v.normals.length&&(N=new se(v.normals,3)),v.color){const E=v.color;o=z.clone(),o.color=new fe(E.r,E.g,E.b),E.a!==1&&(o.transparent=!0,o.opacity=E.a)}const I=v.volumes;for(U=0;U<I.length;U++){const E=I[U],T=new Ne;let V=o;T.setIndex(E.triangles),T.setAttribute("position",g.clone()),N&&T.setAttribute("normal",N.clone()),A[E.materialId]!==void 0&&(V=A[E.materialId]),T.scale(y,y,y),s.add(new be(T,V.clone()))}}B.add(s)}return B}}const nt={class:"box"},rt={class:"option-container"},at={class:"flex-between"},we={__name:"amf",setup(e){const t=new URL("/learning/assets/rook.amf-DyZdIMEA.amf",import.meta.url).href;let n,r,a,f,d;const h=()=>{n=new Ae,n.add(new Fe(10066329)),f=document.querySelector(".box"),r=new Se(35,f.clientWidth/f.clientHeight,1,500),r.up.set(0,0,1),r.position.set(0,-9,6),r.add(new Te(16777215,.8)),n.add(r),a=new Le({antialias:!0}),a.setSize(f.clientWidth,f.clientHeight);const w=new Be(50,50,16777215,5592405);w.rotateOnAxis(new Ue(1,0,0),90*(Math.PI/180)),n.add(w),a.setClearColor("#f2f2f2"),a.domElement&&f.appendChild(a.domElement),new tt().load(t,y=>{y.name="amfTest",n.add(y),m()});const C=()=>{m()};C(),m(),d=new Oe(r,a.domElement),d.addEventListener("change",C),f.appendChild(a.domElement)},i=w=>{a.setClearColor(w.target.value),m()},m=()=>{a.render(n,r)};return je(()=>{h(),m()}),(w,C)=>(ze(),ke("div",nt,[G("div",rt,[G("div",at,[C[1]||(C[1]=G("span",null,"渲染器背景色:",-1)),G("input",{onInput:C[0]||(C[0]=y=>i(y)),value:"#000000",type:"color"},null,32)])])]))}};typeof ce=="function"&&ce(we);const st=Re(we,[["__scopeId","data-v-85d6c492"]]);export{st as default};

import{L as q,F as J,C as K,G as Z,B as N,a as C,o as U,p as S,q as P,M as Q,r as D,s as E,b as O,V as I,S as X,A as Y,P as $,d as ee,W as te,e as se,O as ne}from"./OrbitControls-D_oMNle7.js";import{b as H}from"./route-block-B_A1xBdJ.js";import{_ as ie,o as oe,n as re,b as ae,e as A}from"./index-BtQ9Oy6z.js";const le=/^[og]\s*(.+)?/,ce=/^mtllib /,he=/^usemtl /,ue=/^usemap /,R=new I,B=new I,k=new I,T=new I,x=new I,z=new K;function de(){const M={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(s,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=s,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:s||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,n){const r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);const d={index:this.materials.length,name:e||"",mtllib:Array.isArray(n)&&n.length>0?n[n.length-1]:"",smooth:r!==void 0?r.smooth:this.smooth,groupStart:r!==void 0?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(y){const f={index:typeof y=="number"?y:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return f.clone=this.clone.bind(f),f}};return this.materials.push(d),d},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const n=this.currentMaterial();if(n&&n.groupEnd===-1&&(n.groupEnd=this.geometry.vertices.length/3,n.groupCount=n.groupEnd-n.groupStart,n.inherited=!1),e&&this.materials.length>1)for(let r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),n}},i&&i.name&&typeof i.clone=="function"){const e=i.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(s,t){const i=parseInt(s,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(s,t){const i=parseInt(s,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(s,t){const i=parseInt(s,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(s,t,i){const e=this.vertices,n=this.object.geometry.vertices;n.push(e[s+0],e[s+1],e[s+2]),n.push(e[t+0],e[t+1],e[t+2]),n.push(e[i+0],e[i+1],e[i+2])},addVertexPoint:function(s){const t=this.vertices;this.object.geometry.vertices.push(t[s+0],t[s+1],t[s+2])},addVertexLine:function(s){const t=this.vertices;this.object.geometry.vertices.push(t[s+0],t[s+1],t[s+2])},addNormal:function(s,t,i){const e=this.normals,n=this.object.geometry.normals;n.push(e[s+0],e[s+1],e[s+2]),n.push(e[t+0],e[t+1],e[t+2]),n.push(e[i+0],e[i+1],e[i+2])},addFaceNormal:function(s,t,i){const e=this.vertices,n=this.object.geometry.normals;R.fromArray(e,s),B.fromArray(e,t),k.fromArray(e,i),x.subVectors(k,B),T.subVectors(R,B),x.cross(T),x.normalize(),n.push(x.x,x.y,x.z),n.push(x.x,x.y,x.z),n.push(x.x,x.y,x.z)},addColor:function(s,t,i){const e=this.colors,n=this.object.geometry.colors;e[s]!==void 0&&n.push(e[s+0],e[s+1],e[s+2]),e[t]!==void 0&&n.push(e[t+0],e[t+1],e[t+2]),e[i]!==void 0&&n.push(e[i+0],e[i+1],e[i+2])},addUV:function(s,t,i){const e=this.uvs,n=this.object.geometry.uvs;n.push(e[s+0],e[s+1]),n.push(e[t+0],e[t+1]),n.push(e[i+0],e[i+1])},addDefaultUV:function(){const s=this.object.geometry.uvs;s.push(0,0),s.push(0,0),s.push(0,0)},addUVLine:function(s){const t=this.uvs;this.object.geometry.uvs.push(t[s+0],t[s+1])},addFace:function(s,t,i,e,n,r,d,y,f){const j=this.vertices.length;let l=this.parseVertexIndex(s,j),c=this.parseVertexIndex(t,j),o=this.parseVertexIndex(i,j);if(this.addVertex(l,c,o),this.addColor(l,c,o),d!==void 0&&d!==""){const a=this.normals.length;l=this.parseNormalIndex(d,a),c=this.parseNormalIndex(y,a),o=this.parseNormalIndex(f,a),this.addNormal(l,c,o)}else this.addFaceNormal(l,c,o);if(e!==void 0&&e!==""){const a=this.uvs.length;l=this.parseUVIndex(e,a),c=this.parseUVIndex(n,a),o=this.parseUVIndex(r,a),this.addUV(l,c,o),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(s){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,e=s.length;i<e;i++){const n=this.parseVertexIndex(s[i],t);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(s,t){this.object.geometry.type="Line";const i=this.vertices.length,e=this.uvs.length;for(let n=0,r=s.length;n<r;n++)this.addVertexLine(this.parseVertexIndex(s[n],i));for(let n=0,r=t.length;n<r;n++)this.addUVLine(this.parseUVIndex(t[n],e))}};return M.startObject("",!1),M}class fe extends q{constructor(s){super(s),this.materials=null}load(s,t,i,e){const n=this,r=new J(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(s,function(d){try{t(n.parse(d))}catch(y){e?e(y):console.error(y),n.manager.itemError(s)}},i,e)}setMaterials(s){return this.materials=s,this}parse(s){const t=new de;s.indexOf(`\r
`)!==-1&&(s=s.replace(/\r\n/g,`
`)),s.indexOf(`\\
`)!==-1&&(s=s.replace(/\\\n/g,""));const i=s.split(`
`);let e="",n="",r=0,d=[];const y=typeof"".trimLeft=="function";for(let l=0,c=i.length;l<c;l++)if(e=i[l],e=y?e.trimLeft():e.trim(),r=e.length,r!==0&&(n=e.charAt(0),n!=="#"))if(n==="v"){const o=e.split(/\s+/);switch(o[0]){case"v":t.vertices.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3])),o.length>=7?(z.setRGB(parseFloat(o[4]),parseFloat(o[5]),parseFloat(o[6])).convertSRGBToLinear(),t.colors.push(z.r,z.g,z.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));break;case"vt":t.uvs.push(parseFloat(o[1]),parseFloat(o[2]));break}}else if(n==="f"){const a=e.slice(1).trim().split(/\s+/),g=[];for(let m=0,v=a.length;m<v;m++){const u=a[m];if(u.length>0){const p=u.split("/");g.push(p)}}const b=g[0];for(let m=1,v=g.length-1;m<v;m++){const u=g[m],p=g[m+1];t.addFace(b[0],u[0],p[0],b[1],u[1],p[1],b[2],u[2],p[2])}}else if(n==="l"){const o=e.substring(1).trim().split(" ");let a=[];const g=[];if(e.indexOf("/")===-1)a=o;else for(let b=0,m=o.length;b<m;b++){const v=o[b].split("/");v[0]!==""&&a.push(v[0]),v[1]!==""&&g.push(v[1])}t.addLineGeometry(a,g)}else if(n==="p"){const a=e.slice(1).trim().split(" ");t.addPointGeometry(a)}else if((d=le.exec(e))!==null){const o=(" "+d[0].slice(1).trim()).slice(1);t.startObject(o)}else if(he.test(e))t.object.startMaterial(e.substring(7).trim(),t.materialLibraries);else if(ce.test(e))t.materialLibraries.push(e.substring(7).trim());else if(ue.test(e))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(n==="s"){if(d=e.split(" "),d.length>1){const a=d[1].trim().toLowerCase();t.object.smooth=a!=="0"&&a!=="off"}else t.object.smooth=!0;const o=t.object.currentMaterial();o&&(o.smooth=t.object.smooth)}else{if(e==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+e+'"')}t.finalize();const f=new Z;if(f.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let l=0,c=t.objects.length;l<c;l++){const o=t.objects[l],a=o.geometry,g=o.materials,b=a.type==="Line",m=a.type==="Points";let v=!1;if(a.vertices.length===0)continue;const u=new N;u.setAttribute("position",new C(a.vertices,3)),a.normals.length>0&&u.setAttribute("normal",new C(a.normals,3)),a.colors.length>0&&(v=!0,u.setAttribute("color",new C(a.colors,3))),a.hasUVIndices===!0&&u.setAttribute("uv",new C(a.uvs,2));const p=[];for(let L=0,F=g.length;L<F;L++){const _=g[L],G=_.name+"_"+_.smooth+"_"+v;let h=t.materials[G];if(this.materials!==null){if(h=this.materials.create(_.name),b&&h&&!(h instanceof U)){const V=new U;S.prototype.copy.call(V,h),V.color.copy(h.color),h=V}else if(m&&h&&!(h instanceof P)){const V=new P({size:10,sizeAttenuation:!1});S.prototype.copy.call(V,h),V.color.copy(h.color),V.map=h.map,h=V}}h===void 0&&(b?h=new U:m?h=new P({size:1,sizeAttenuation:!1}):h=new Q,h.name=_.name,h.flatShading=!_.smooth,h.vertexColors=v,t.materials[G]=h),p.push(h)}let w;if(p.length>1){for(let L=0,F=g.length;L<F;L++){const _=g[L];u.addGroup(_.groupStart,_.groupCount,L)}b?w=new D(u,p):m?w=new E(u,p):w=new O(u,p)}else b?w=new D(u,p[0]):m?w=new E(u,p[0]):w=new O(u,p[0]);w.name=o.name,f.add(w)}else if(t.vertices.length>0){const l=new P({size:1,sizeAttenuation:!1}),c=new N;c.setAttribute("position",new C(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(c.setAttribute("color",new C(t.colors,3)),l.vertexColors=!0);const o=new E(c,l);f.add(o)}return f}}const me={className:"box"},pe={className:"option-container"},ge={className:"flex-between"},W={__name:"obj",setup(M){const s=new URL("/learning/assets/maya2.obj-DaZ4aKeu.obj",import.meta.url).href;let t,i,e,n,r;const d=()=>{t=new X,t.add(new Y(10066329)),n=document.querySelector(".box"),i=new $(35,n.clientWidth/n.clientHeight,1,500),i.up.set(0,0,1),i.position.set(0,-9,6),i.add(new ee(16777215,1)),t.add(i),e=new te({antialias:!0}),e.setSize(n.clientWidth,n.clientHeight);const j=new se(50,50,11184810,5592405);j.rotateOnAxis(new I(1,0,0),90*(Math.PI/180)),t.add(j),e.setClearColor("#f2f2f2"),n.appendChild(e.domElement),new fe().load(s,c=>{c.name="objTest",c.position.set(0,0,2),c.rotation.y=Math.PI/4,t.add(c),f()});const l=()=>{f()};l(),f(),r=new ne(i,e.domElement),r.addEventListener("change",l),n.appendChild(e.domElement)},y=j=>{e.setClearColor(j.target.value),f()},f=()=>{e.render(t,i)};return oe(()=>{d(),f()}),(j,l)=>(ae(),re("div",me,[A("div",pe,[A("div",ge,[l[1]||(l[1]=A("span",null,"渲染器背景色:",-1)),A("input",{onInput:l[0]||(l[0]=c=>y(c)),value:"#000000",type:"color"},null,32)])])]))}};typeof H=="function"&&H(W);const ye=ie(W,[["__scopeId","data-v-081fe6f6"]]);export{ye as default};
